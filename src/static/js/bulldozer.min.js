function Bulldozer(){this.KeepTrackOfButtonsTime=[0,0,0,0],this.ButtonPressed=[!1,!1,!1,!1],this.ButtonHold=[!1,!1,!1,!1],this.boulderMoves=0;var a=GetLevel(Map.level);this.x=a[0]+shiX,this.y=a[1]+shiY,this.width=Map.tileSize,this.height=Map.tileSize,this.rotation=0,this.canMoveLeft=!0,this.canMoveRight=!0,this.canMoveUp=!0,this.canMoveDown=!0,this.boulderLeft=-1,this.boulderRight=-1,this.boulderDown=-1,this.boulderUp=-1,this.dozer=new Image,this.dozer.src="images/Sprites/Bulldozer.png"}function Rectangle(){}function Rectangle(a,b,c,d){this.positionX=a,this.positionY=b,this.width=c,this.height=d,this.left=a,this.top=b,this.right=a+c-1,this.bottom=b+d-1}function Intersect(a,b){return!(b.left>a.right||b.right<a.left||b.top>a.bottom||b.bottom<a.top)}function IntersectAll(a,b){if(a.length!=b.length)return!1;var c=fillArray(!1,a.length);for(i=0;i<a.length;i++)for(j=0;j<b.length;j++)Intersect(a[i],b[j])&&(c[i]=!0);return AllValuesTrue(c)}function AllValuesTrue(a){if(a.length>0){for(i=0;i<a.length;i++)if(1!=a[i])return!1;return!0}}function fillArray(a,b){for(var c=[],d=0;b>d;d++)c.push(a);return c}function RFP(a,b,c){var d=[];for(i=0;i<[a.length];i++)d.push(new Rectangle(a[i][0]+b,a[i][1]+c,Map.tileSize,Map.tileSize));return d}function DrawRectArray(a,b,c){for(i=0;i<c.length;i++)a.drawImage(b,c[i].positionX-c[i].width/2,c[i].positionY-c[i].height/2)}function DrawRotatedImage(a,b,c,d,e,f,g){a.save(),a.translate(c,d),a.rotate(g*TO_RADIANS),a.drawImage(b,-(e/2),-(f/2)),a.restore()}function FormatTimer(a,b){return diffmilli=b-a,millis=diffmilli%1e3,x=diffmilli/1e3,secs=Math.floor(x%60),x/=60,mins=Math.floor(x%60),x/=60,hours=Math.floor(x%24),x/=24,days=Math.floor(x),hours+":"+mins+":"+secs+":"+millis}function NotificationAppear(){notificationModal.style.display="block";var b=Game.canvas.getBoundingClientRect(),c=notificationModal.getBoundingClientRect(),d=b.left+(b.width-c.width)/2,e=b.top+(b.height-c.height);notificationModal.innerHTML=Map.level+1 in levelPassword?"<div id='notif-head'><p id='tittle'> <b> Level  "+Map.level+"</b></p></div><p> Success! <br> Password: "+levelPassword[Map.level+1]+" </p><button class='btn btn-lg btn-primary' id='notif-close-button'>Continue</button>":"<div id='notif-head'><p id='tittle'> <b> Level  "+Map.level+"</b></p></div><p> Success! </p><button class='btn btn-lg btn-primary' id='notif-close-button'>Continue</button>",notificationModal.style.left=d.toString()+"px",notificationModal.style.top=e.toString()+"px",c=notificationModal.getBoundingClientRect();var f=document.getElementById("notif-close-button"),g=f.getBoundingClientRect(),h=(c.width-g.width)/2;f.style.left=h.toString()+"px",f.onclick=Game.Continue}function NotificationDisappear(){notificationModal.style.display="none"}function postScore(a,b,c){AssignUserName(),username=document.getElementById("username-box").value,strt="username="+username+"&level="+a+"&moves="+b+"&time="+c,$("#scores-table").hide(),""!=strt&&(xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){4==xmlhttp.readyState&&200==xmlhttp.status?console.log("Successful score posting: "+xmlhttp.responseText):console.log("no response")},xmlhttp.open("GET","postScore.php?"+strt,!0),xmlhttp.send())}function postStart(a){AssignUserName(),username=document.getElementById("username-box").value,strt="username="+username+"&level="+a,$("#scores-table").hide(),""!=strt&&(xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){4==xmlhttp.readyState&&200==xmlhttp.status?console.log("Successful start posting: "+xmlhttp.responseText):console.log("no response")},xmlhttp.open("GET","postStart.php?"+strt,!0),xmlhttp.send())}function AssignUserName(){us=document.getElementById("username-box").value,"USERNAME"==us.trim().toUpperCase()&&(us=randUsers[Math.floor(Math.random()*randUsers.length)]+Math.floor(1e3*Math.random())),document.getElementById("username-box").value=us}var TO_RADIANS=Math.PI/180,shiX=16,shiY=16,initialDelay=250,holdDelay=70,levelPassword={4:"BONK",8:"NERD",12:"BURP",16:"SPUD",20:"GROK",24:"SPOT",28:"KALE",32:"PODS",36:"TAPS",40:"KRIL",44:"GNIP",48:"GORN",52:"LOUT",56:""},Key={_pressed:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,isDown:function(a){return this._pressed[a]},onKeydown:function(a){this._pressed[a.keyCode]=!0,(37==a.keyCode||38==a.keyCode||39==a.keyCode||40==a.keyCode)&&a.preventDefault()},onKeyup:function(a){delete this._pressed[a.keyCode]}};window.addEventListener("keyup",function(a){Key.onKeyup(a)},!1),window.addEventListener("keydown",function(a){Key.onKeydown(a)},!1);var Game={fps:60,width:640,height:384};Game._onEachFrame=function(){var a=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;return a?function(b){var c=function(){b(),a(c)};c()}:function(a){setInterval(a,1e3/Game.fps)}}(),Game.init=function(){Map.LoadImages(),Game.start()},Game.start=function(){Game.canvas=document.getElementById("game-canvas"),Game.canvas.width=Game.width,Game.canvas.height=Game.height,Game.startTime=new Date,Game.context=Game.canvas.getContext("2d"),Game.isRunning=!0,Map.GetPassLevel(),Map.LoadLevel(Map.level),postStart("Level "+Map.level.toString()),Game.bulldozer=new Bulldozer,$("p#curr-level").text("Level "+Map.level.toString()),$("textarea#password-box").val("password"),Game._onEachFrame(Game.run)},Game.pause=function(){},Game.run=function(){var a=0,b=1e3/Game.fps,d=(new Date).getTime();return function(){for(a=0;(new Date).getTime()>d;)Game.isRunning&&Game.update(),d+=b,a++;a&&Game.draw()}}(),Game.draw=function(){Map.Draw(Game.context),Game.bulldozer.draw(Game.context)},Game.update=function(){Game.bulldozer.Update(),Game.CheckLevelComplete()},Game.CheckLevelComplete=function(){var a=!1;a=IntersectAll(Map.boulder_rect_list,Map.target_rect_list),a&&Game.NewLevel(),Map.level>Map.lastLevel&&Game.Win()},Game.NewLevel=function(){NotificationAppear(),Game.isRunning=!1,Game.endTime=new Date,time=FormatTimer(Game.startTime,Game.endTime),postScore("Level "+Map.level.toString(),Game.bulldozer.boulderMoves.toString(),time)},Game.Continue=function(){NotificationDisappear(),Game.isRunning=!0,Map.level+=1,Game.Reset()},Game.Win=function(){},Game.Reset=function(){Game.start()};var Map={tileSize:32,level:1,startLevel:1,lastLevel:61,LoadImages:function(){Map.background=new Image,Map.bricks=new Image,Map.block=new Image,Map.target=new Image,Map.boulder=new Image,Map.cdiamond=new Image,Map.odiamond=new Image,Map.circle=new Image,Map.spiral=new Image,Map.plus=new Image,Map.square=new Image,Map.background.src="images/Sprites/Background.png",Map.bricks.src="images/Sprites/Bricks.png",Map.block.src="images/Sprites/Block.png",Map.target.src="images/Sprites/2Target.png",Map.boulder.src="images/Sprites/Boulder.png",Map.cdiamond.src="images/Sprites/CDiamond.png",Map.odiamond.src="images/Sprites/ODiamond.png",Map.circle.src="images/Sprites/Circle.png",Map.spiral.src="images/Sprites/Spiral.png",Map.plus.src="images/Sprites/Plus.png",Map.square.src="images/Sprites/Square.png"},GetPassLevel:function(){var a=document.getElementById("password-box").value,b=Map.level;"BONK"==a.toUpperCase()?b=4:"NERD"==a.toUpperCase()?b=8:"BURP"==a.toUpperCase()?b=12:"SPUD"==a.toUpperCase()?b=16:"GROK"==a.toUpperCase()?b=20:"SPOT"==a.toUpperCase()?b=24:"KALE"==a.toUpperCase()?b=28:"PODS"==a.toUpperCase()?b=32:"TAPS"==a.toUpperCase()?b=36:"KRIL"==a.toUpperCase()?b=40:"GNIP"==a.toUpperCase()?b=44:"GORN"==a.toUpperCase()?b=48:"LOUT"==a.toUpperCase()?b=52:""==a.toUpperCase()?b=56:"FLU"==a.toUpperCase()?b=15:"ME"==a.toUpperCase()?b=43:"DANG"==a.toUpperCase()?b=10:0==a.indexOf("f")&&3==a.indexOf("u")&&(b=parseInt(a.substring(1,3))),Map.level=b},LoadLevel:function(a){var b=GetLevel(a),c=b[2],d=b[3];for(Map.boulder_rect_list=[],i=0;i<d.length;i++)Map.boulder_rect_list[i]=new Rectangle(c[i]+shiX,d[i]+shiY,Map.tileSize,Map.tileSize);Map.bricks_rect_list=RFP(b[4],shiX,shiY),Map.block_rect_list=RFP(b[5],shiX,shiY),Map.target_rect_list=RFP(b[6],shiX,shiY),Map.cdiamond_rect_list=RFP(b[7],shiX,shiY),Map.odiamond_rect_list=RFP(b[8],shiX,shiY),Map.circle_rect_list=RFP(b[9],shiX,shiY),Map.spiral_rect_list=RFP(b[10],shiX,shiY),Map.plus_rect_list=RFP(b[11],shiX,shiY),Map.square_rect_list=RFP(b[12],shiX,shiY),Map.collision_rect_list=Map.bricks_rect_list.concat(Map.block_rect_list,Map.cdiamond_rect_list,Map.odiamond_rect_list,Map.circle_rect_list,Map.spiral_rect_list,Map.square_rect_list,Map.plus_rect_list)},Draw:function(a){a.drawImage(Map.background,0,0),DrawRectArray(a,Map.bricks,Map.bricks_rect_list),DrawRectArray(a,Map.block,Map.block_rect_list),DrawRectArray(a,Map.target,Map.target_rect_list),DrawRectArray(a,Map.cdiamond,Map.cdiamond_rect_list),DrawRectArray(a,Map.odiamond,Map.odiamond_rect_list),DrawRectArray(a,Map.circle,Map.circle_rect_list),DrawRectArray(a,Map.spiral,Map.spiral_rect_list),DrawRectArray(a,Map.plus,Map.plus_rect_list),DrawRectArray(a,Map.square,Map.square_rect_list),DrawRectArray(a,Map.boulder,Map.boulder_rect_list)},MoveBoulder:function(a,b){var c=Map.boulder_rect_list.slice(0);c.splice(a,1);var d=!0,e=new Rectangle;shiftX=0,shiftY=0,"UP"==b?shiftY=-Map.tileSize:"DOWN"==b?shiftY=Map.tileSize:"LEFT"==b?shiftX=-Map.tileSize:"RIGHT"==b&&(shiftX=Map.tileSize);var e=new Rectangle(Map.boulder_rect_list[a].positionX+shiftX,Map.boulder_rect_list[a].positionY+shiftY,Map.tileSize,Map.tileSize);for(i=0;i<c.length;i++)Intersect(e,c[i])&&(d=!1);for(i=0;i<Map.collision_rect_list.length;i++)Intersect(e,Map.collision_rect_list[i])&&(d=!1);d?(Map.boulder_rect_list[a]=new Rectangle(Map.boulder_rect_list[a].positionX+shiftX,Map.boulder_rect_list[a].positionY+shiftY,Map.tileSize,Map.tileSize),Game.bulldozer.boulderMoves+=1):"UP"==b?Game.bulldozer.canMoveUp=!1:"DOWN"==b?Game.bulldozer.canMoveDown=!1:"LEFT"==b?Game.bulldozer.canMoveLeft=!1:"RIGHT"==b&&(Game.bulldozer.canMoveRight=!1)}};Bulldozer.prototype.draw=function(a){DrawRotatedImage(a,this.dozer,this.x,this.y,this.width,this.height,this.rotation)},Bulldozer.prototype.moveLeft=function(){this.x-=Map.tileSize},Bulldozer.prototype.moveRight=function(){this.x+=Map.tileSize},Bulldozer.prototype.moveUp=function(){this.y-=Map.tileSize},Bulldozer.prototype.moveDown=function(){this.y+=Map.tileSize},Bulldozer.prototype.CheckFutureWalls=function(){for(this.canMoveRight=!0,this.canMoveLeft=!0,this.canMoveDown=!0,this.canMoveUp=!0,rightRect=new Rectangle(this.x+Map.tileSize,this.y,Map.tileSize,Map.tileSize),leftRect=new Rectangle(this.x-Map.tileSize,this.y,Map.tileSize,Map.tileSize),upRect=new Rectangle(this.x,this.y-Map.tileSize,Map.tileSize,Map.tileSize),downRect=new Rectangle(this.x,this.y+Map.tileSize,Map.tileSize,Map.tileSize),i=0;i<Map.collision_rect_list.length;i++)Intersect(rightRect,Map.collision_rect_list[i])&&(this.canMoveRight=!1),Intersect(leftRect,Map.collision_rect_list[i])&&(this.canMoveLeft=!1),Intersect(upRect,Map.collision_rect_list[i])&&(this.canMoveUp=!1),Intersect(downRect,Map.collision_rect_list[i])&&(this.canMoveDown=!1)},Bulldozer.prototype.FindBoulders=function(){for(this.boulderLeft=-1,this.boulderRight=-1,this.boulderDown=-1,this.boulderUp=-1,rightRect=new Rectangle(this.x+Map.tileSize,this.y,Map.tileSize,Map.tileSize),leftRect=new Rectangle(this.x-Map.tileSize,this.y,Map.tileSize,Map.tileSize),upRect=new Rectangle(this.x,this.y-Map.tileSize,Map.tileSize,Map.tileSize),downRect=new Rectangle(this.x,this.y+Map.tileSize,Map.tileSize,Map.tileSize),i=0;i<Map.boulder_rect_list.length;i++)Intersect(rightRect,Map.boulder_rect_list[i])&&(this.boulderRight=i),Intersect(leftRect,Map.boulder_rect_list[i])&&(this.boulderLeft=i),Intersect(upRect,Map.boulder_rect_list[i])&&(this.boulderUp=i),Intersect(downRect,Map.boulder_rect_list[i])&&(this.boulderDown=i)},Bulldozer.prototype.Update=function(){this.now=(new Date).getTime(),this.CheckFutureWalls(),this.FindBoulders(),Key.isDown(Key.UP)&&!this.ButtonPressed[0]?(this.boulderUp>-1&&Map.MoveBoulder(this.boulderUp,"UP"),this.canMoveUp&&(this.moveUp(),this.KeepTrackOfButtonsTime[0]=this.now,this.ButtonPressed[0]=!0),this.rotation=180):Key.isDown(Key.LEFT)&&!this.ButtonPressed[1]?(this.boulderLeft>-1&&Map.MoveBoulder(this.boulderLeft,"LEFT"),this.canMoveLeft&&(this.moveLeft(),this.KeepTrackOfButtonsTime[1]=this.now,this.ButtonPressed[1]=!0),this.rotation=90):Key.isDown(Key.DOWN)&&!this.ButtonPressed[2]?(this.boulderDown>-1&&Map.MoveBoulder(this.boulderDown,"DOWN"),this.canMoveDown&&(this.moveDown(),this.KeepTrackOfButtonsTime[2]=this.now,this.ButtonPressed[2]=!0),this.rotation=0):Key.isDown(Key.RIGHT)&&!this.ButtonPressed[3]&&(this.boulderRight>-1&&Map.MoveBoulder(this.boulderRight,"RIGHT"),this.canMoveRight&&(this.moveRight(),this.KeepTrackOfButtonsTime[3]=this.now,this.ButtonPressed[3]=!0),this.rotation=270),!Key.isDown(Key.UP)&&this.ButtonPressed[0]?(this.ButtonPressed[0]=!1,this.ButtonHold[0]=!1):!Key.isDown(Key.LEFT)&&this.ButtonPressed[1]?(this.ButtonPressed[1]=!1,this.ButtonHold[1]=!1):!Key.isDown(Key.DOWN)&&this.ButtonPressed[2]?(this.ButtonPressed[2]=!1,this.ButtonHold[2]=!1):!Key.isDown(Key.RIGHT)&&this.ButtonPressed[3]&&(this.ButtonPressed[3]=!1,this.ButtonHold[3]=!1),this.now-this.KeepTrackOfButtonsTime[0]>initialDelay&&this.ButtonPressed[0]?this.ButtonHold[0]=!0:this.now-this.KeepTrackOfButtonsTime[1]>initialDelay&&this.ButtonPressed[1]?this.ButtonHold[1]=!0:this.now-this.KeepTrackOfButtonsTime[2]>initialDelay&&this.ButtonPressed[2]?this.ButtonHold[2]=!0:this.now-this.KeepTrackOfButtonsTime[3]>initialDelay&&this.ButtonPressed[3]&&(this.ButtonHold[3]=!0),this.ButtonHold[0]&&this.now-this.KeepTrackOfButtonsTime[0]>holdDelay&&this.canMoveUp?(this.boulderUp>-1&&Map.MoveBoulder(this.boulderUp,"UP"),this.canMoveUp&&(this.moveUp(),this.KeepTrackOfButtonsTime[0]=this.now,this.ButtonPressed[0]=!0),this.rotation=180):this.ButtonHold[1]&&this.now-this.KeepTrackOfButtonsTime[1]>holdDelay&&this.canMoveLeft?(this.boulderLeft>-1&&Map.MoveBoulder(this.boulderLeft,"LEFT"),this.canMoveLeft&&(this.moveLeft(),this.KeepTrackOfButtonsTime[1]=this.now,this.ButtonPressed[1]=!0),this.rotation=90):this.ButtonHold[2]&&this.now-this.KeepTrackOfButtonsTime[2]>holdDelay&&this.canMoveDown?(this.boulderDown>-1&&Map.MoveBoulder(this.boulderDown,"DOWN"),this.canMoveDown&&(this.moveDown(),this.KeepTrackOfButtonsTime[2]=this.now,this.ButtonPressed[2]=!0),this.rotation=0):this.ButtonHold[3]&&this.now-this.KeepTrackOfButtonsTime[3]>holdDelay&&this.canMoveRight&&(this.boulderRight>-1&&Map.MoveBoulder(this.boulderRight,"RIGHT"),this.canMoveRight&&(this.moveRight(),this.KeepTrackOfButtonsTime[3]=this.now,this.ButtonPressed[3]=!0),this.rotation=270)},Rectangle.prototype.Update=function(a,b,c,d){this.positionX=a,this.positionY=b,this.width=c,this.height=d,this.left=a,this.top=b,this.right=a+c-1,this.bottom=b+d-1},$("#password-box").focus(function(){this.value===this.defaultValue&&(this.value="")}).blur(function(){""===this.value&&(this.value=this.defaultValue)}),$("textarea").keyup(function(){$(this).val($(this).val().replace(/\v+/g,""))});var startButton=document.getElementById("start-button"),resetButton=document.getElementById("reset-button"),notificationModal=document.getElementById("notification-modal");startButton.onclick=Game.init,resetButton.onclick=Game.start;var randUsers=["ron","veronica","gordo","whynousername?","cantbebothered","johnnyboi","doozy","balogna"];